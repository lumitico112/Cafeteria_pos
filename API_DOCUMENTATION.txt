# ========================================
# DOCUMENTACIÃ“N API REST - SISTEMA POS CAFETERÃA
# Backend Spring Boot para Frontend Angular
# ========================================

## ğŸš€ INICIO RÃPIDO

1. **Crear base de datos**: Ejecutar script SQL `database/schema.sql`
2. Clonar proyecto: git clone <repo-url>
3. Crear .env: copy .env.example .env
4. Editar .env: configurar DB_PASSWORD y JWT_SECRET_KEY
5. Instalar: mvn clean install
6. Ejecutar: mvn spring-boot:run
7. Backend corriendo en: http://localhost:8080
8. Desarrollar frontend Angular en proyecto separado (puerto 4200)

Estado del Backend: âœ… LISTO PARA DESARROLLO ANGULAR
Schema Status: âœ… VALIDADO Y FUNCIONAL (ddl-auto=validate)

## ğŸ—„ï¸ CONFIGURACIÃ“N DE BASE DE DATOS

### âš ï¸ IMPORTANTE: Base de Datos Manual

**El proyecto NO crea las tablas automÃ¡ticamente**. Debes ejecutar el script SQL manualmente.

### Pasos para Crear la Base de Datos:

1. **Accede a MySQL:**
   ```bash
   mysql -u root -p
   ```

2. **Ejecuta el script de base de datos:**
   ```sql
   source C:/D/AGOSTO 2025/Desarrollo web Integrado/cafeteria/database/schema.sql
   ```
   
   O desde lÃ­nea de comandos:
   ```bash
   mysql -u root -p < database/schema.sql
   ```

3. **Verifica que se creÃ³ correctamente:**
   ```sql
   USE sistema_pos;
   SHOW TABLES;
   ```

### Lo que Incluye el Script SQL:

âœ… **Tablas completas** con todas las columnas y tipos de datos
âœ… **Relaciones (Foreign Keys)** entre todas las tablas
âœ… **Ãndices optimizados** para bÃºsquedas rÃ¡pidas:
   - Ãndices simples en campos frecuentemente consultados
   - Ãndices compuestos para consultas complejas
   - Ãndices FULLTEXT para bÃºsqueda de texto
   
âœ… **Triggers automÃ¡ticos**:
   - **Auto-crear Cliente**: Cuando se crea un Usuario con rol CLIENTE, automÃ¡ticamente se crea su registro en tabla `cliente`
   - **Actualizar Stock**: Reduce inventario automÃ¡ticamente al completar un pedido
   - **Calcular Totales**: Calcula el total del pedido automÃ¡ticamente
   - **Validar Stock**: Valida que haya stock suficiente antes de crear pedido
   - **AuditorÃ­a**: Registra cambios importantes
   
âœ… **Vistas Ãºtiles**:
   - `v_productos_stock_bajo`: Productos que necesitan reabastecimiento
   - `v_ventas_por_dia`: EstadÃ­sticas diarias de ventas
   - `v_productos_mas_vendidos`: Top productos vendidos
   
âœ… **Procedimientos almacenados**:
   - `sp_reporte_ventas`: Genera reporte de ventas por rango de fechas
   - `sp_inventario_critico`: Lista productos con stock crÃ­tico
   
âœ… **Eventos programados**:
   - Limpia tokens JWT expirados diariamente
   - Actualiza estado de promociones vencidas cada hora
   
âœ… **Datos iniciales (Roles y Permisos)**:
   - Roles: ADMIN, EMPLEADO, CLIENTE
   - Permisos bÃ¡sicos para cada mÃ³dulo
   - AsociaciÃ³n roles-permisos predefinida

### ConfiguraciÃ³n de spring.jpa.hibernate.ddl-auto:

El proyecto estÃ¡ configurado con `ddl-auto=validate`:
- âœ… Spring Boot **valida** que las tablas existan
- âœ… Spring Boot **NO crea** ni **modifica** tablas
- âœ… Si hay diferencias con las entidades Java, la aplicaciÃ³n **falla** al inicio (esto es bueno para detectar errores)
- âœ… El esquema se mantiene **estable** y **controlado** vÃ­a SQL

### âš™ï¸ ConfiguraciÃ³n de Seguridad (OPCIONAL - Recomendado en ProducciÃ³n)

**Para DESARROLLO:** Puedes usar el usuario `root` directamente.

**Para PRODUCCIÃ“N:** Ejecuta el script de seguridad:
```bash
mysql -u root -p < database/security_config.sql
```

**Lo que hace security_config.sql:**
âœ… Crea usuario `cafeteria_app` con privilegios mÃ­nimos
âœ… Solo permisos SELECT, INSERT, UPDATE, DELETE, EXECUTE
âœ… Bloquea DROP, ALTER, CREATE (mayor seguridad)
âœ… Configura timeouts y variables de rendimiento
âœ… Habilita logs de consultas lentas
âœ… Crea usuario para backups

**Actualizar .env para usar usuario seguro:**
```properties
DB_USERNAME=cafeteria_app
DB_PASSWORD=CafeteriaApp_2025!
```

âš ï¸ **IMPORTANTE:** Cambiar la contraseÃ±a en `security_config.sql` antes de ejecutar en producciÃ³n

**Ver:** `database/README.md` para instrucciones detalladas

## âš ï¸ SEGURIDAD CRÃTICA - LEER PRIMERO

### 1. CONFIGURACIÃ“N INICIAL DEL PROYECTO

**IMPORTANTE**: El archivo .env NO estÃ¡ incluido en el repositorio por seguridad.

PASOS OBLIGATORIOS ANTES DE INICIAR:

1. Copia el archivo .env.example a .env:
   Windows: copy .env.example .env
   Linux/Mac: cp .env.example .env

2. Genera una clave JWT SEGURA (ejecuta UNO de estos):
   
   # PowerShell (Windows):
   [Convert]::ToBase64String((1..32|%{Get-Random -Max 256}))
   
   # OpenSSL (Linux/Mac/Git Bash):
   openssl rand -base64 32
   
   # Node.js (cualquier plataforma):
   node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"

3. Edita el archivo .env y actualiza OBLIGATORIAMENTE:
   
   DB_PASSWORD=TU_PASSWORD_MYSQL_REAL
   JWT_SECRET_KEY=LA_CLAVE_GENERADA_EN_EL_PASO_2
   
   Ejemplo:
   DB_PASSWORD=DataBase_1.
   JWT_SECRET_KEY=WgBl1a4xhMCmurt65MB+Lg26u3OQt+n4tAI9ahDTs=

4. Valores opcionales que puedes ajustar en .env:
   - DB_HOST, DB_PORT, DB_NAME (si MySQL estÃ¡ en otro servidor)
   - FILE_UPLOAD_DIR (ruta donde se guardan imÃ¡genes)
   - REPORTS_COMPANY_NAME, REPORTS_COMPANY_ADDRESS, etc.
   - CORS_ALLOWED_ORIGINS (URL de tu frontend Angular)

5. Descargar dependencias e instalar:
   mvn clean install

6. Ejecutar la aplicaciÃ³n:
   mvn spring-boot:run
   
   O usar el IDE run/debug

### 2. GITIGNORE - PROTECCIÃ“N AUTOMÃTICA

El archivo .gitignore YA estÃ¡ configurado y protege:
- âœ… .env (NUNCA se subirÃ¡ a Git - cada desarrollador crea el suyo)
- âœ… uploads/ (archivos subidos por usuarios)
- âœ… temp/ y logs/ (archivos temporales)
- âœ… target/ (archivos compilados)

VERIFICACIÃ“N antes de cada commit:
git status
# El archivo .env NO debe aparecer en la lista
# Si aparece, el .gitignore tiene un error

### 3. ARQUITECTURA DEL SISTEMA

Spring Boot Backend (Puerto 8080):
- API REST pura (JSON)
- AutenticaciÃ³n JWT
- Sin vistas HTML (solo endpoints)

Angular Frontend (Puerto 4200 - proyecto separado):
- ConsumirÃ¡ la API REST
- Interfaz de usuario completa
- ComunicaciÃ³n vÃ­a HTTP + JWT

### 4. DEPENDENCIAS CLAVE

spring-dotenv (v4.0.0):
- Carga automÃ¡ticamente el archivo .env
- No requiere configuraciÃ³n adicional
- Variables disponibles como ${VAR_NAME} en application.properties

spring-boot-starter-security + JWT:
- AutenticaciÃ³n basada en tokens
- Sin sesiones (stateless)
- Tokens vÃ¡lidos por 24 horas

iText7 (v7.2.5):
- GeneraciÃ³n de PDFs (boletas, reportes)

Apache POI (v5.2.3):
- GeneraciÃ³n y lectura de Excel
- ImportaciÃ³n/exportaciÃ³n masiva

### 5. CHECKLIST DE SEGURIDAD PRE-PRODUCCIÃ“N

Antes de desplegar a producciÃ³n:
â˜ Generar nueva JWT_SECRET_KEY Ãºnica (NUNCA usar la de desarrollo)
â˜ Usar contraseÃ±as fuertes de base de datos
â˜ Habilitar HTTPS/SSL (certificado vÃ¡lido)
â˜ Configurar CORS solo para dominios autorizados de producciÃ³n
â˜ Cambiar credenciales de usuarios por defecto (admin@cafeteria.com)
â˜ Implementar rate limiting para prevenir ataques
â˜ Verificar que .env NO existe en el repositorio: git ls-files | grep .env
â˜ Configurar backups automÃ¡ticos de base de datos
â˜ Habilitar logging de auditorÃ­a en producciÃ³n
â˜ Validar todos los inputs (ya implementado en backend)
â˜ Usar variables de entorno del sistema operativo en lugar de .env
â˜ Revisar y actualizar dependencias a Ãºltimas versiones seguras
â˜ Configurar firewall para MySQL (solo acceso desde backend)
â˜ Deshabilitar spring.jpa.show-sql=true en producciÃ³n

## CONFIGURACIÃ“N BASE
Base URL: http://localhost:8080
Content-Type: application/json
Authorization: Bearer {JWT_TOKEN}

## AUTENTICACIÃ“N JWT

### 1. Login (POST /auth/login)
Endpoint: POST /auth/login
AutenticaciÃ³n: No requerida (pÃºblico)
Content-Type: application/json

Request Body:
{
  "correo": "admin@cafeteria.com",
  "contrasena": "admin123"
}

Response Success (200):
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}

Response Error (401):
{
  "message": "Credenciales invÃ¡lidas"
}

### 2. Registro (POST /auth/register)
Endpoint: POST /auth/register
AutenticaciÃ³n: No requerida (pÃºblico)
Content-Type: application/json

Request Body:
{
  "firstname": "Juan",
  "lastname": "Perez",
  "email": "juan.perez@example.com",
  "password": "password123",
  "phone": "987654321",
  "address": "Av. Principal 123"
}

Response Success (200):
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}

NOTA: idRol valores:
- 1 = ADMIN
- 2 = EMPLEADO
- 3 = CLIENTE

## ========================================
## GESTIÃ“N DE CATEGORÃAS
## ========================================

### 1. Listar CategorÃ­as (GET /categorias)
Endpoint: GET /categorias
AutenticaciÃ³n: Requerida (Bearer Token)
Roles: Todos

Response Success (200):
[
  {
    "idCategoria": 1,
    "nombre": "Bebidas Calientes",
    "descripcion": "CafÃ©, tÃ©, chocolate"
  },
  {
    "idCategoria": 2,
    "nombre": "Bebidas FrÃ­as",
    "descripcion": "Jugos, smoothies, frappes"
  }
]

### 2. Obtener CategorÃ­a por ID (GET /categorias/{id})
Endpoint: GET /categorias/{id}
AutenticaciÃ³n: Requerida
Roles: Todos

Response Success (200):
{
  "idCategoria": 1,
  "nombre": "Bebidas Calientes",
  "descripcion": "CafÃ©, tÃ©, chocolate"
}

### 3. Crear CategorÃ­a (POST /categorias)
Endpoint: POST /categorias
AutenticaciÃ³n: Requerida
Roles: ADMIN, EMPLEADO

Request Body:
{
  "nombre": "Postres",
  "descripcion": "Pasteles y galletas"
}

Response Success (201):
{
  "idCategoria": 5,
  "nombre": "Postres",
  "descripcion": "Pasteles y galletas"
}

### 4. Actualizar CategorÃ­a (PUT /categorias/{id})
Endpoint: PUT /categorias/{id}
AutenticaciÃ³n: Requerida
Roles: ADMIN, EMPLEADO

Request Body:
{
  "nombre": "Postres Especiales",
  "descripcion": "Pasteles gourmet"
}

### 5. Eliminar CategorÃ­a (DELETE /categorias/{id})
Endpoint: DELETE /categorias/{id}
AutenticaciÃ³n: Requerida
Roles: ADMIN

Response Success (204): No Content

## ========================================
## GESTIÃ“N DE PRODUCTOS
## ========================================

### 1. Listar Todos los Productos (GET /productos)
Endpoint: GET /productos
AutenticaciÃ³n: Requerida
Roles: Todos

Response Success (200):
[
  {
    "idProducto": 1,
    "nombre": "CafÃ© Americano",
    "descripcion": "CafÃ© negro 8oz",
    "precio": 5.50,
    "impuesto": 0.18,
    "imagenUrl": "cafe-americano.jpg",
    "estado": "ACTIVO",
    "idCategoria": 1,
    "nombreCategoria": "Bebidas Calientes",
    "cantidadActual": 100,
    "stockMinimo": 10,
    "unidadMedida": "unidad"
  }
]

Estados vÃ¡lidos: ACTIVO, INACTIVO

### 2. Buscar Producto por ID (GET /productos/{id})
Endpoint: GET /productos/{id}
AutenticaciÃ³n: Requerida
Roles: Todos

Response Success (200):
{
  "idProducto": 1,
  "nombre": "CafÃ© Americano",
  "descripcion": "CafÃ© negro 8oz",
  "precio": 5.50,
  "impuesto": 0.18,
  "imagenUrl": "cafe-americano.jpg",
  "estado": "ACTIVO",
  "idCategoria": 1,
  "nombreCategoria": "Bebidas Calientes",
  "cantidadActual": 100,
  "stockMinimo": 10,
  "unidadMedida": "unidad"
}

### 3. Listar Productos por CategorÃ­a (GET /productos/categoria/{idCategoria})
Endpoint: GET /productos/categoria/{idCategoria}
AutenticaciÃ³n: Requerida
Roles: Todos

### 4. Listar Productos Disponibles (GET /productos/disponibles)
Endpoint: GET /productos/disponibles
AutenticaciÃ³n: Requerida
Roles: Todos

### 5. Crear Producto (POST /productos)
Endpoint: POST /productos
AutenticaciÃ³n: Requerida
Roles: ADMIN, EMPLEADO

Request Body:
{
  "nombre": "Cappuccino",
  "descripcion": "CafÃ© con leche espumosa",
  "precio": 7.50,
  "impuesto": 0.18,
  "imagenUrl": "cappuccino.jpg",
  "estado": "ACTIVO",
  "idCategoria": 1,
  "cantidadActual": 50,
  "stockMinimo": 10,
  "unidadMedida": "unidad"
}

Response Success (201):
{
  "idProducto": 10,
  "nombre": "Cappuccino",
  ...
}

### 6. Actualizar Producto (PUT /productos/{id})
Endpoint: PUT /productos/{id}
AutenticaciÃ³n: Requerida
Roles: ADMIN, EMPLEADO

Request Body: (mismo que crear)

### 7. Eliminar Producto (DELETE /productos/{id})
Endpoint: DELETE /productos/{id}
AutenticaciÃ³n: Requerida
Roles: ADMIN

## ========================================
## GESTIÃ“N DE USUARIOS
## ========================================

### 1. Listar Usuarios (GET /usuarios)
Endpoint: GET /usuarios
AutenticaciÃ³n: Requerida
Roles: ADMIN

Response Success (200):
[
  {
    "idUsuario": 1,
    "nombre": "Admin",
    "apellido": "Sistema",
    "correo": "admin@cafeteria.com",
    "estado": "ACTIVO",
    "fechaCreacion": "2025-01-15T10:30:00",
    "idRol": 1,
    "nombreRol": "ADMIN",
    "telefono": "987654321",
    "direccion": "Calle Principal 123",
    "puntosFidelizacion": 0
  }
]

### 2. Buscar Usuario por ID (GET /usuarios/{id})
Endpoint: GET /usuarios/{id}
AutenticaciÃ³n: Requerida
Roles: ADMIN o el mismo usuario

### 3. Buscar Usuario por Email (GET /usuarios/email/{correo})
Endpoint: GET /usuarios/email/{correo}
AutenticaciÃ³n: Requerida
Roles: ADMIN o el mismo usuario

### 4. Crear Usuario (POST /usuarios)
Endpoint: POST /usuarios
AutenticaciÃ³n: Requerida
Roles: ADMIN

Request Body:
{
  "nombre": "MarÃ­a",
  "apellido": "GonzÃ¡lez",
  "correo": "maria@example.com",
  "contrasena": "pass123",
  "idRol": 2,
  "telefono": "987654321",
  "direccion": "Calle 123"
}

### 5. Actualizar Usuario (PUT /usuarios/{id})
Endpoint: PUT /usuarios/{id}
AutenticaciÃ³n: Requerida
Roles: ADMIN o el mismo usuario

### 6. Eliminar Usuario (DELETE /usuarios/{id})
Endpoint: DELETE /usuarios/{id}
AutenticaciÃ³n: Requerida
Roles: ADMIN

## ========================================
## GESTIÃ“N DE PEDIDOS
## ========================================

### 1. Listar Todos los Pedidos (GET /pedidos)
Endpoint: GET /pedidos
AutenticaciÃ³n: Requerida
Roles: ADMIN, EMPLEADO

Response Success (200):
[
  {
    "idPedido": 1,
    "fecha": "2025-11-26T14:30:00",
    "estado": "ENTREGADO",
    "tipoEntrega": "LOCAL",
    "total": 25.50,
    "idUsuario": 3,
    "nombreCliente": "Juan PÃ©rez",
    "atendidoPor": 2,
    "nombreEmpleado": "MarÃ­a LÃ³pez",
    "detalles": [
      {
        "idDetalle": 1,
        "idProducto": 1,
        "nombreProducto": "CafÃ© Americano",
        "cantidad": 2,
        "precioUnitario": 5.50,
        "subtotal": 11.00
      },
      {
        "idDetalle": 2,
        "idProducto": 5,
        "nombreProducto": "Croissant",
        "cantidad": 3,
        "precioUnitario": 4.50,
        "subtotal": 13.50
      }
    ]
  }
]

### 2. Listar Pedidos por Usuario (GET /pedidos/usuario/{idUsuario})
Endpoint: GET /pedidos/usuario/{idUsuario}
AutenticaciÃ³n: Requerida
Roles: ADMIN, EMPLEADO o el mismo usuario

### 3. Listar Pedidos por Estado (GET /pedidos/estado/{estado})
Endpoint: GET /pedidos/estado/{estado}
AutenticaciÃ³n: Requerida
Roles: ADMIN, EMPLEADO

Estados vÃ¡lidos: PENDIENTE, PREPARACION, LISTO, ENTREGADO, CANCELADO
Tipo de entrega: DELIVERY, RETIRO, LOCAL

### 4. Buscar Pedido por ID (GET /pedidos/{id})
Endpoint: GET /pedidos/{id}
AutenticaciÃ³n: Requerida
Roles: ADMIN, EMPLEADO o propietario del pedido

### 5. Crear Pedido (POST /pedidos)
Endpoint: POST /pedidos
AutenticaciÃ³n: Requerida
Roles: Todos

Request Body:
{
  "idUsuario": 3,
  "tipoEntrega": "DELIVERY",
  "detalles": [
    {
      "idProducto": 1,
      "cantidad": 2
    },
    {
      "idProducto": 5,
      "cantidad": 1
    }
  ]
}

Response Success (201):
{
  "idPedido": 15,
  "fecha": "2025-11-26T19:00:00",
  "estado": "PENDIENTE",
  "tipoEntrega": "DELIVERY",
  "total": 15.50,
  ...
}

### 6. Cambiar Estado de Pedido (PUT /pedidos/{id}/estado)
Endpoint: PUT /pedidos/{id}/estado
AutenticaciÃ³n: Requerida
Roles: ADMIN, EMPLEADO

Request Body:
{
  "estado": "PREPARACION"
}

Estados vÃ¡lidos: PENDIENTE, PREPARACION, LISTO, ENTREGADO, CANCELADO

## ========================================
## GESTIÃ“N DE INVENTARIO
## ========================================

### 1. Listar Todo el Inventario (GET /inventario)
Endpoint: GET /inventario
AutenticaciÃ³n: Requerida
Roles: ADMIN, EMPLEADO

Response Success (200):
[
  {
    "idInventario": 1,
    "producto": {
      "idProducto": 1,
      "nombre": "CafÃ© Americano"
    },
    "cantidadActual": 100,
    "stockMinimo": 10,
    "unidadMedida": "unidad",
    "fechaActualizacion": "2025-11-26T10:00:00"
  }
]

### 2. Buscar Inventario por Producto (GET /inventario/producto/{idProducto})
Endpoint: GET /inventario/producto/{idProducto}
AutenticaciÃ³n: Requerida
Roles: ADMIN, EMPLEADO

### 3. Listar Productos con Stock Bajo (GET /inventario/bajo-stock)
Endpoint: GET /inventario/bajo-stock
AutenticaciÃ³n: Requerida
Roles: ADMIN, EMPLEADO

### 4. Actualizar Stock (PUT /inventario/{id})
Endpoint: PUT /inventario/{id}
AutenticaciÃ³n: Requerida
Roles: ADMIN, EMPLEADO

Request Body:
{
  "cantidadActual": 150,
  "stockMinimo": 15
}

## ========================================
## GESTIÃ“N DE PROMOCIONES
## ========================================

### 1. Listar Promociones (GET /promociones)
Endpoint: GET /promociones
AutenticaciÃ³n: Requerida
Roles: Todos

Response Success (200):
[
  {
    "idPromocion": 1,
    "nombre": "Happy Hour CafÃ©",
    "descripcion": "2x1 en cafÃ©s de 3pm a 5pm",
    "tipo": "DOS_POR_UNO",
    "fechaInicio": "2025-11-01",
    "fechaFin": "2025-11-30",
    "estado": "ACTIVA"
  },
  {
    "idPromocion": 2,
    "nombre": "Combo Desayuno",
    "descripcion": "CafÃ© + croissant por S/10",
    "tipo": "COMBO",
    "fechaInicio": "2025-12-01",
    "fechaFin": "2025-12-31",
    "estado": "ACTIVA"
  }
]

### 2. Listar Promociones Activas (GET /promociones/activas)
Endpoint: GET /promociones/activas
AutenticaciÃ³n: Requerida
Roles: Todos

### 3. Crear PromociÃ³n (POST /promociones)
Endpoint: POST /promociones
AutenticaciÃ³n: Requerida
Roles: ADMIN

Request Body:
{
  "nombre": "Descuento Especial",
  "descripcion": "Descuento en productos seleccionados",
  "tipo": "DESCUENTO",
  "fechaInicio": "2025-12-01",
  "fechaFin": "2025-12-31"
}

Tipos vÃ¡lidos: DESCUENTO, COMBO, DOS_POR_UNO
Fechas en formato: YYYY-MM-DD

### 4. Actualizar PromociÃ³n (PUT /promociones/{id})
Endpoint: PUT /promociones/{id}
AutenticaciÃ³n: Requerida
Roles: ADMIN

### 5. Eliminar PromociÃ³n (DELETE /promociones/{id})
Endpoint: DELETE /promociones/{id}
AutenticaciÃ³n: Requerida
Roles: ADMIN

## ========================================
## GESTIÃ“N DE ARCHIVOS
## ========================================

### 1. Subir Archivo (POST /files/upload)
Endpoint: POST /files/upload
AutenticaciÃ³n: Requerida
Roles: ADMIN, EMPLEADO
Content-Type: multipart/form-data

Request Body (FormData):
file: <archivo binario>

Response Success (200):
{
  "filename": "a1b2c3d4-e5f6-7890-abcd-ef1234567890.jpg",
  "message": "Archivo subido exitosamente"
}

Tipos permitidos: image/jpeg, image/png, image/jpg, image/gif
TamaÃ±o mÃ¡ximo: 10MB

### 2. Descargar Archivo (GET /files/download/{filename})
Endpoint: GET /files/download/{filename}
AutenticaciÃ³n: No requerida (pÃºblico)

Response Success (200):
Content-Type: application/octet-stream
Body: <archivo binario>

### 3. Eliminar Archivo (DELETE /files/{filename})
Endpoint: DELETE /files/{filename}
AutenticaciÃ³n: Requerida
Roles: ADMIN, EMPLEADO

Response Success (200):
{
  "message": "Archivo eliminado exitosamente"
}

## ========================================
## REPORTES
## ========================================

### 1. Generar Boleta PDF (GET /reportes/boleta/{pedidoId})
Endpoint: GET /reportes/boleta/{pedidoId}
AutenticaciÃ³n: Requerida
Roles: ADMIN, EMPLEADO

Response Success (200):
Content-Type: application/pdf
Content-Disposition: attachment; filename="boleta_15.pdf"
Body: <PDF binario>

### 2. Generar Ticket ASCII (GET /reportes/ticket/{pedidoId})
Endpoint: GET /reportes/ticket/{pedidoId}
AutenticaciÃ³n: Requerida
Roles: ADMIN, EMPLEADO

Response Success (200):
Content-Type: text/plain
Content-Disposition: attachment; filename="ticket_15.txt"
Body: <Texto ASCII>

### 3. Reporte de Pedidos (GET /reportes/pedidos)
Endpoint: GET /reportes/pedidos?fechaInicio={ISO}&fechaFin={ISO}&estado={ESTADO}&idUsuario={ID}&formato={PDF|EXCEL}
AutenticaciÃ³n: Requerida
Roles: ADMIN, EMPLEADO

Query Parameters (todos opcionales):
- fechaInicio: 2025-01-01T00:00:00
- fechaFin: 2025-12-31T23:59:59
- estado: PENDIENTE|PREPARACION|LISTO|ENTREGADO|CANCELADO
- idUsuario: 3
- formato: PDF o EXCEL (default: PDF)

Response Success (200):
Content-Type: application/pdf o application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
Content-Disposition: attachment; filename="reporte_pedidos.pdf"

### 4. Reporte de Productos (GET /reportes/productos)
Endpoint: GET /reportes/productos?idCategoria={ID}&formato={PDF|EXCEL}
AutenticaciÃ³n: Requerida
Roles: ADMIN, EMPLEADO

### 5. Reporte de Usuarios (GET /reportes/usuarios)
Endpoint: GET /reportes/usuarios?formato={PDF|EXCEL}
AutenticaciÃ³n: Requerida
Roles: ADMIN

### 6. Reporte de Inventario (GET /reportes/inventario)
Endpoint: GET /reportes/inventario?formato={PDF|EXCEL}
AutenticaciÃ³n: Requerida
Roles: ADMIN, EMPLEADO

## ========================================
## OPERACIONES MASIVAS (BULK)
## ========================================

### 1. Importar Usuarios desde Excel (POST /bulk/usuarios/import)
Endpoint: POST /bulk/usuarios/import
AutenticaciÃ³n: Requerida
Roles: ADMIN
Content-Type: multipart/form-data

Request Body (FormData):
file: <archivo .xlsx>

Response Success (200):
{
  "success": 45,
  "errors": 2,
  "errorDetails": [
    "Fila 10: Email duplicado",
    "Fila 25: Rol invÃ¡lido"
  ],
  "message": "Importados: 45, Errores: 2"
}

### 2. Importar Productos desde Excel (POST /bulk/productos/import)
Endpoint: POST /bulk/productos/import
AutenticaciÃ³n: Requerida
Roles: ADMIN
Content-Type: multipart/form-data

Request Body (FormData):
file: <archivo .xlsx>

Response Success (200):
{
  "success": 120,
  "errors": 0,
  "errorDetails": [],
  "message": "Importados: 120, Errores: 0"
}

### 3. Descargar Plantilla de Usuarios (GET /bulk/template/usuarios)
Endpoint: GET /bulk/template/usuarios
AutenticaciÃ³n: Requerida
Roles: ADMIN

Response Success (200):
Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
Content-Disposition: attachment; filename="plantilla_usuarios.xlsx"

### 4. Descargar Plantilla de Productos (GET /bulk/template/productos)
Endpoint: GET /bulk/template/productos
AutenticaciÃ³n: Requerida
Roles: ADMIN

## ========================================
## DASHBOARD ADMINISTRATIVO
## ========================================

### 1. Obtener EstadÃ­sticas del Dashboard (GET /admin/dashboard)
Endpoint: GET /admin/dashboard
AutenticaciÃ³n: Requerida
Roles: ADMIN

Response Success (200):
{
  "totalUsuarios": 45,
  "totalProductos": 120,
  "totalPedidos": 350,
  "ventasHoy": 1500.50,
  "ventasMes": 45000.00,
  "pedidosPendientes": 8
}

## ========================================
## CONFIGURACIÃ“N CORS PARA ANGULAR
## ========================================

El backend debe configurar CORS para permitir requests desde Angular.

ConfiguraciÃ³n necesaria en SecurityConfig.java:

@Bean
public CorsConfigurationSource corsConfigurationSource() {
    CorsConfiguration configuration = new CorsConfiguration();
    configuration.setAllowedOrigins(Arrays.asList("http://localhost:4200"));
    configuration.setAllowedMethods(Arrays.asList("GET", "POST", "PUT", "DELETE", "OPTIONS"));
    configuration.setAllowedHeaders(Arrays.asList("*"));
    configuration.setAllowCredentials(true);
    
    UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
    source.registerCorsConfiguration("/**", configuration);
    return source;
}

## ========================================
## MANEJO DE ERRORES
## ========================================

Respuestas de error estÃ¡ndar:

400 Bad Request:
{
  "message": "Datos invÃ¡lidos",
  "errors": ["El campo nombre es requerido"]
}

401 Unauthorized:
{
  "message": "No autorizado",
  "error": "Token JWT invÃ¡lido o expirado"
}

403 Forbidden:
{
  "message": "Acceso denegado",
  "error": "No tienes permisos para esta operaciÃ³n"
}

404 Not Found:
{
  "message": "Recurso no encontrado",
  "error": "El producto con ID 999 no existe"
}

500 Internal Server Error:
{
  "message": "Error interno del servidor",
  "error": "Detalles del error..."
}

## ========================================
## FLUJO DE AUTENTICACIÃ“N EN ANGULAR
## ========================================

1. Usuario hace login en /auth/login
2. Backend retorna JWT token
3. Angular guarda el token en localStorage o sessionStorage
4. Para cada request subsecuente, Angular incluye el header:
   Authorization: Bearer {token}
5. Backend valida el token en cada request
6. Si el token expira (24 horas), usuario debe hacer login nuevamente

Ejemplo en Angular:

// auth.service.ts
login(correo: string, contrasena: string) {
  return this.http.post<{token: string}>('http://localhost:8080/auth/login', {
    correo,
    contrasena
  }).pipe(
    tap(response => {
      localStorage.setItem('token', response.token);
    })
  );
}

// http.interceptor.ts
intercept(request: HttpRequest<any>, next: HttpHandler) {
  const token = localStorage.getItem('token');
  if (token) {
    request = request.clone({
      setHeaders: {
        Authorization: `Bearer ${token}`
      }
    });
  }
  return next.handle(request);
}

## ========================================
## VARIABLES DE ENTORNO PARA ANGULAR
## ========================================

environment.ts (desarrollo):
export const environment = {
  production: false,
  apiUrl: 'http://localhost:8080',
  fileUploadMaxSize: 10485760, // 10MB
  allowedImageTypes: ['image/jpeg', 'image/png', 'image/jpg', 'image/gif'],
  jwtTokenKey: 'cafeteria_jwt_token'
};

environment.prod.ts (producciÃ³n):
export const environment = {
  production: true,
  apiUrl: 'https://api.cafeteria.com',
  fileUploadMaxSize: 10485760,
  allowedImageTypes: ['image/jpeg', 'image/png', 'image/jpg', 'image/gif'],
  jwtTokenKey: 'cafeteria_jwt_token'
};

## ========================================
## MODELOS/INTERFACES TYPESCRIPT PARA ANGULAR
## ========================================

// models/usuario.model.ts
export interface Usuario {
  idUsuario?: number;
  nombre: string;
  apellido: string;
  correo: string;
  contrasena?: string;
  estado?: 'ACTIVO' | 'INACTIVO';
  fechaCreacion?: Date;
  idRol: number;
  nombreRol?: string;
  telefono?: string;
  direccion?: string;
}

// models/producto.model.ts
export interface Producto {
  idProducto?: number;
  nombre: string;
  descripcion?: string;
  precio: number;
  imagenUrl?: string;
  estado?: 'DISPONIBLE' | 'AGOTADO' | 'DESCONTINUADO';
  idCategoria: number;
  nombreCategoria?: string;
  cantidadActual?: number;
  stockMinimo?: number;
  unidadMedida?: string;
}

// models/pedido.model.ts
export interface Pedido {
  idPedido?: number;
  fecha?: Date;
  estado?: 'PENDIENTE' | 'EN_PROCESO' | 'COMPLETADO' | 'CANCELADO';
  tipoEntrega: 'LOCAL' | 'DOMICILIO';
  total?: number;
  idUsuario: number;
  nombreCliente?: string;
  idEmpleado?: number;
  nombreEmpleado?: string;
  detalles: DetallePedido[];
}

export interface DetallePedido {
  idDetallePedido?: number;
  idProducto: number;
  nombreProducto?: string;
  cantidad: number;
  precioUnitario?: number;
  subtotal?: number;
}

// models/categoria.model.ts
export interface Categoria {
  idCategoria?: number;
  nombre: string;
  descripcion?: string;
}

// models/promocion.model.ts
export interface Promocion {
  idPromocion?: number;
  nombre: string;
  descripcion?: string;
  porcentajeDescuento: number;
  fechaInicio: Date;
  fechaFin: Date;
  imagenUrl?: string;
  estado?: 'ACTIVA' | 'INACTIVA';
}

// models/auth.model.ts
export interface LoginRequest {
  correo: string;
  contrasena: string;
}

export interface RegisterRequest {
  nombre: string;
  apellido: string;
  correo: string;
  contrasena: string;
  idRol: number;
}

export interface AuthResponse {
  token: string;
}

## ========================================
## ESTRUCTURA DE CARPETAS RECOMENDADA PARA ANGULAR
## ========================================

src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ core/                    # Servicios singleton, guards, interceptors
â”‚   â”‚   â”œâ”€â”€ guards/
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.guard.ts
â”‚   â”‚   â”‚   â””â”€â”€ role.guard.ts
â”‚   â”‚   â”œâ”€â”€ interceptors/
â”‚   â”‚   â”‚   â”œâ”€â”€ jwt.interceptor.ts
â”‚   â”‚   â”‚   â””â”€â”€ error.interceptor.ts
â”‚   â”‚   â””â”€â”€ services/
â”‚   â”‚       â”œâ”€â”€ auth.service.ts
â”‚   â”‚       â””â”€â”€ storage.service.ts
â”‚   â”œâ”€â”€ shared/                  # Componentes, directivas, pipes compartidos
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ directives/
â”‚   â”‚   â””â”€â”€ pipes/
â”‚   â”œâ”€â”€ models/                  # Interfaces y modelos
â”‚   â”‚   â”œâ”€â”€ usuario.model.ts
â”‚   â”‚   â”œâ”€â”€ producto.model.ts
â”‚   â”‚   â”œâ”€â”€ pedido.model.ts
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ services/               # Servicios de features
â”‚   â”‚   â”œâ”€â”€ producto.service.ts
â”‚   â”‚   â”œâ”€â”€ pedido.service.ts
â”‚   â”‚   â”œâ”€â”€ usuario.service.ts
â”‚   â”‚   â”œâ”€â”€ categoria.service.ts
â”‚   â”‚   â”œâ”€â”€ promocion.service.ts
â”‚   â”‚   â”œâ”€â”€ inventario.service.ts
â”‚   â”‚   â”œâ”€â”€ reporte.service.ts
â”‚   â”‚   â””â”€â”€ file.service.ts
â”‚   â”œâ”€â”€ pages/                  # PÃ¡ginas/Vistas principales
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â””â”€â”€ register/
â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”œâ”€â”€ productos/
â”‚   â”‚   â”œâ”€â”€ pedidos/
â”‚   â”‚   â”œâ”€â”€ usuarios/
â”‚   â”‚   â”œâ”€â”€ inventario/
â”‚   â”‚   â”œâ”€â”€ promociones/
â”‚   â”‚   â””â”€â”€ reportes/
â”‚   â””â”€â”€ app.component.ts
â”œâ”€â”€ assets/
â”‚   â”œâ”€â”€ images/
â”‚   â””â”€â”€ icons/
â””â”€â”€ environments/
    â”œâ”€â”€ environment.ts
    â””â”€â”€ environment.prod.ts

## ========================================
## CONSIDERACIONES DE SEGURIDAD
## ========================================

1. NUNCA almacenar contraseÃ±as en texto plano
2. Validar SIEMPRE los datos del lado del servidor (el backend ya lo hace)
3. Usar HTTPS en producciÃ³n
4. Implementar rate limiting para prevenir ataques de fuerza bruta
5. Validar el token JWT en cada request
6. Sanitizar inputs para prevenir XSS
7. Implementar CORS correctamente
8. No exponer informaciÃ³n sensible en mensajes de error

## ========================================
## PRÃ“XIMOS PASOS RECOMENDADOS
## ========================================

1. Configurar proyecto Angular con Angular CLI
2. Instalar dependencias necesarias (HttpClient, Forms, Router)
3. Crear servicios para cada entidad
4. Implementar guards para proteger rutas
5. Crear interceptors para JWT y manejo de errores
6. Desarrollar componentes de UI
7. Implementar formularios reactivos
8. Agregar validaciones del lado del cliente
9. Crear mÃ³dulo de reportes con descarga de archivos
10. Implementar paginaciÃ³n y bÃºsqueda en tablas
11. Agregar notificaciones Toast/Snackbar
12. Optimizar con lazy loading de mÃ³dulos
13. Implementar PWA para uso offline (opcional)
14. Agregar pruebas unitarias y E2E

## ========================================
## COMANDOS ÃšTILES PARA DESARROLLO
## ========================================

# Iniciar backend Spring Boot
cd cafeteria
mvn spring-boot:run

# Crear proyecto Angular
ng new cafeteria-frontend
cd cafeteria-frontend
ng serve

# Generar servicios
ng generate service services/producto
ng generate service services/pedido
ng generate service services/auth

# Generar componentes
ng generate component pages/productos
ng generate component pages/pedidos

# Generar guards
ng generate guard core/guards/auth

# Build para producciÃ³n
ng build --prod

## ========================================
## CONTACTO Y SOPORTE
## ========================================

Backend API: http://localhost:8080
Swagger/API Docs: (pendiente de implementar)
Database: MySQL en localhost:3306/sistema_pos

Credenciales de prueba:
Admin:
  Email: admin@cafeteria.com
  Password: admin123

Empleado:
  Email: empleado@cafeteria.com
  Password: empleado123

Cliente:
  Email: cliente@cafeteria.com
  Password: cliente123

## FIN DE LA DOCUMENTACIÃ“N
